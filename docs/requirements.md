# Requirements Document - AI Context Management Tool

## プロジェクト要件定義

### 1. プロジェクト概要

#### 1.1 目的
複数のAIコーディングエージェント用のcontextファイルを統一設定から自動生成するコマンドラインツールを開発し、NPMパッケージとして配布する。

#### 1.2 背景
- 開発者が複数のAIツール（GitHub Copilot、Cline、Cursor、Claude Code）を使い分ける際の設定管理が煩雑
- 各ツール固有のファイル形式・配置場所・設定方法が異なる
- 同じコンテキスト情報を複数箇所で重複管理する必要がある
- チーム間での設定同期が困難

#### 1.3 解決したい課題
- コンテキスト設定の一元管理
- ファイル形式の差異の吸収
- 設定変更時の更新作業の自動化
- チーム全体での設定共有の促進

### 2. 機能要件

#### 2.1 サポート対象AIツール

| ツール名 | 出力ファイル | 形式 | 分割対応 |
|---------|-------------|------|---------|
| GitHub Copilot | `instructions.md` (階層配置) | Markdown | ○ |
| Cline | `.clinerules/` ディレクトリ | Markdown | ○ |
| Cursor | `.cursor/rules/` ディレクトリ | MDC (Markdown + frontmatter) | ○ |
| Claude Code | `CLAUDE.md` | Markdown | × |

#### 2.2 コア機能

##### 2.2.1 初期化機能 (`ai-context init`)
- **必須機能**:
  - `docs/` ディレクトリ構造の自動作成
  - 設定ファイル `ai-context.yaml` のテンプレート生成
  - サンプルMarkdownファイルの生成

- **ディレクトリ構造**:
```
docs/
├── common/           # 共通ナレッジ
│   ├── coding-standards.md
│   ├── project-overview.md
│   └── team-conventions.md
├── agents/           # エージェント固有設定
│   ├── github.md
│   ├── cline.md
│   ├── cursor.md
│   └── claude.md
└── ai-context.yaml   # 設定ファイル
```

##### 2.2.2 生成機能 (`ai-context generate`)
- **統合モード（デフォルト）**:
  - 全Markdownファイルを結合
  - 各エージェントに1つのcontextファイルとして出力

- **分割モード (`--split`)**:
  - 分割対応エージェント（GitHub Copilot、Cline、Cursor）は複数ファイルで出力
  - 非対応エージェント（Claude）は統合モードと同じ

- **エージェント指定 (`--agent`)**:
  - 特定のエージェントのみファイル生成
  - カンマ区切りで複数指定可能

- **プレビュー機能 (`--dry-run`)**:
  - 実際にファイル生成せず、出力予定ファイルを表示

##### 2.2.3 検証機能 (`ai-context validate`)
- 設定ファイルの構文チェック
- 必要なMarkdownファイルの存在確認
- エージェント固有設定の妥当性検証

##### 2.2.4 表示機能 (`ai-context show`)
- 現在の設定内容表示
- ファイルマッピング状況の表示
- 生成対象ファイル一覧の表示

#### 2.3 エージェント固有機能

##### 2.3.1 Cursor固有機能
- **frontmatter対応**:
  - `type`: `always` | `auto_attached` | `agent_requested` | `manual`
  - `description`: ルールの説明
  - `globs`: 適用対象ファイルパターン

- **分割ファイル生成**:
  - 設定に基づいて複数の `.mdc` ファイルを生成
  - 各ファイルに適切なfrontmatterを付与

##### 2.3.2 Cline固有機能
- **数値プレフィックス対応**:
  - ファイル名に数値プレフィックスを付与（例: `01-common.md`）
  - 読み込み順序の制御

- **分割ファイル生成**:
  - 設定に基づいて複数の `.md` ファイルを生成

##### 2.3.3 GitHub Copilot固有機能
- **階層的ファイル配置**:
  - ワークスペース内の任意の場所に `instructions.md` を配置
  - ディレクトリ階層に応じた適用スコープの制御
  - より具体的な（深い）指示が優先される階層システム

- **スコープ別設定**:
  - `workspace`: プロジェクト全体に適用
  - `source_code`: ソースコードディレクトリに適用
  - `ui_components`: UIコンポーネントに適用

- **追加指示対応**:
  - エージェント固有の追加指示を設定可能

##### 2.3.4 Claude Code固有機能
- **言語設定対応**:
  - 日本語での出力指示の追加
- **セクション管理**:
  - 開発コマンド、アーキテクチャ情報等の構造化

#### 2.4 設定システム

##### 2.4.1 設定ファイル仕様
- **形式**: YAML
- **ファイル名**: `ai-context.yaml`
- **必須項目**:
  - `version`: 設定ファイルバージョン
  - `output_mode`: `merged` | `split`
  - `base_docs_dir`: ベースディレクトリ（デフォルト: `docs`）

##### 2.4.2 オーバーライド機能
- エージェント固有設定の上書き可能
- グローバル変数の定義・参照
- テンプレート変数の置換

### 3. 非機能要件

#### 3.1 パフォーマンス要件
- **起動時間**: 1秒以内
- **ファイル生成時間**: 100ファイル未満のプロジェクトで5秒以内
- **メモリ使用量**: 100MB以下

#### 3.2 可用性要件
- **Node.js対応バージョン**: 16.0.0以上
- **OS対応**: Windows、macOS、Linux
- **オフライン動作**: インターネット接続不要

#### 3.3 保守性要件
- **TypeScript使用**: 型安全性の確保
- **テストカバレッジ**: 80%以上
- **ドキュメント**: 全API・設定項目の文書化

#### 3.4 セキュリティ要件
- **ファイルアクセス制限**: プロジェクトディレクトリ内のみアクセス
- **入力値検証**: 全ユーザー入力の適切な検証
- **依存関係**: 既知の脆弱性を含む依存関係の排除

### 4. ユーザビリティ要件

#### 4.1 CLIインターフェース
- **直感的なコマンド名**: `init`, `generate`, `validate`, `show`
- **ヘルプ機能**: `--help` オプションでの詳細説明
- **エラーメッセージ**: 分かりやすいエラーメッセージと解決方法の提示

#### 4.2 設定ファイル
- **YAML形式**: 人間が読みやすい形式
- **コメント対応**: 設定項目の説明をコメントで記載
- **スキーマ検証**: JSON Schemaによる設定ファイル検証

#### 4.3 出力ファイル
- **適切な改行**: プラットフォーム依存の改行コード対応
- **文字エンコーディング**: UTF-8での出力
- **ファイル権限**: 適切なファイル権限の設定

### 5. 配布・インストール要件

#### 5.1 NPMパッケージ要件
- **パッケージ名**: `ai-context-management`
- **インストール方法**:
  - グローバルインストール: `npm install -g ai-context-management`
  - ローカルインストール: `npm install --save-dev ai-context-management`
- **CLIコマンド**: `ai-context`

#### 5.2 バージョニング
- **セマンティックバージョニング**: MAJOR.MINOR.PATCH
- **後方互換性**: マイナーバージョンアップでの後方互換性保証

### 6. 制約事項

#### 6.1 技術制約
- **Node.js依存**: Node.js環境が必要
- **ファイルシステム**: ローカルファイルシステムのみ対応
- **テンプレート制限**: Handlebars.jsの機能範囲内

#### 6.2 機能制約
- **リアルタイム更新**: ファイル監視機能は初期版では非対応
- **GUI**: コマンドラインインターフェースのみ
- **クラウド連携**: 外部サービス連携は初期版では非対応

### 7. 将来拡張予定

#### 7.1 Phase 2機能
- **ウォッチモード**: ファイル変更時の自動生成
- **プラグインシステム**: カスタムエージェント対応
- **設定継承**: プロジェクト階層での設定継承

#### 7.2 Phase 3機能
- **Web UI**: ブラウザベースの設定管理
- **クラウド同期**: チーム設定のクラウド同期
- **テンプレートマーケット**: 共有テンプレートの配布

### 8. 受け入れ基準

#### 8.1 機能受け入れ基準
- [ ] `ai-context init` でディレクトリ構造が正しく作成される
- [ ] 統合モードで全エージェントのcontextファイルが生成される
- [ ] 分割モードでCline、Cursorの複数ファイルが生成される
- [ ] エージェント固有設定（frontmatter、prefix等）が正しく適用される
- [ ] 設定ファイルの検証機能が正常に動作する

#### 8.2 品質受け入れ基準
- [ ] 全テストケースがパスする
- [ ] テストカバレッジが80%以上
- [ ] Lintエラーが存在しない
- [ ] セキュリティ脆弱性が検出されない

#### 8.3 パフォーマンス受け入れ基準
- [ ] 起動時間が1秒以内
- [ ] 100ファイルプロジェクトでの生成時間が5秒以内
- [ ] メモリ使用量が100MB以下

#### 8.4 ユーザビリティ受け入れ基準
- [ ] 初心者でも10分以内にセットアップ完了
- [ ] エラーメッセージが問題解決に役立つ
- [ ] ヘルプドキュメントが充実している