# Requirements Document - AI Code Agent Context Management Tool (Simplified)

## プロジェクト要件定義（シンプル版）

### 1. プロジェクト概要

#### 1.1 目的

複数の AI コーディングエージェント用の context ファイルを統一設定から自動生成するシンプルなコマンドラインツールを開発し、Cargo パッケージとして配布する。

#### 1.2 背景

- 開発者が複数の AI ツール（GitHub Copilot、Cline、Cursor、Claude Code）を使い分ける際の設定管理が煩雑
- 各ツール固有のファイル形式・配置場所・設定方法が異なる
- 同じコンテキスト情報を複数箇所で重複管理する必要がある
- チーム間での設定同期が困難

#### 1.3 解決したい課題

- コンテキスト設定の一元管理
- ファイル形式の差異の吸収
- 設定変更時の更新作業の自動化
- チーム全体での設定共有の促進
- パフォーマンスの向上（Rust による高速化）
- **シンプル性の重視**: YAGNI（You Aren't Gonna Need It）原則に従った最小限の機能実装

### 2. 機能要件

#### 2.1 サポート対象 AI ツール

| ツール名       | 出力ファイル                 | 形式                         | 分割対応 | 実装状況    |
| -------------- | ---------------------------- | ---------------------------- | -------- | ----------- |
| Cursor         | `.cursor/rules/*.mdc`        | MDC (Markdown + frontmatter) | ○        | ✅ 実装済み |
| Cline          | `.clinerules/*.md`           | Markdown                     | ○        | 🚧 今後実装 |
| GitHub Copilot | `instructions.md` (階層配置) | Markdown                     | ○        | 🚧 今後実装 |
| Claude Code    | `CLAUDE.md`                  | Markdown                     | ×        | 🚧 今後実装 |

#### 2.2 コア機能

##### 2.2.1 初期化機能 (`aicm init`)

- **必須機能**:

  - `docs/` ディレクトリの自動作成
  - 設定ファイル `ai-context.yaml` のテンプレート生成
  - README.md ファイルの生成

- **シンプルなディレクトリ構造**:

```
docs/
├── README.md         # 使い方説明
├── overview.md       # プロジェクト概要
├── rules.md          # コーディングルール
└── *.md              # 任意のmarkdownファイル
ai-context.yaml       # 設定ファイル
```

##### 2.2.2 生成機能 (`aicm generate`)

- **自動ファイル検出**:

  - `docs/` ディレクトリ配下の `.md` ファイルを自動検出
  - サブディレクトリの再帰検索に対応

- **統合モード（デフォルト）**:

  - 全 Markdown ファイルを結合
  - 各エージェントに 1 つの context ファイルとして出力

- **分割モード (`output_mode: split`)**:

  - ファイルごとに個別の出力ファイルを生成
  - ファイル名は元のmarkdownファイル名を保持

- **エージェント指定 (`--agent`)**:
  - 特定のエージェントのみファイル生成
  - 現在は `cursor` のみ対応

##### 2.2.3 検証機能 (`aicm validate`)

- 設定ファイルの構文チェック
- ドキュメントディレクトリの存在確認
- エージェント設定の基本的な妥当性検証

#### 2.3 エージェント固有機能

##### 2.3.1 Cursor 固有機能 ✅ 実装済み

- **シンプルな frontmatter 対応**:

  - `description`: ルールの説明（固定値）
  - `alwaysApply`: 常に適用（true 固定）

- **分割ファイル生成**:
  - markdownファイルごとに `.mdc` ファイルを生成
  - 各ファイルに統一された frontmatter を付与

##### 2.3.2 その他のエージェント 🚧 今後実装

- **Cline**: `.clinerules/*.md` ファイルの生成
- **GitHub Copilot**: `instructions.md` ファイルの生成
- **Claude Code**: `CLAUDE.md` ファイルの生成

#### 2.4 設定システム

##### 2.4.1 設定ファイル仕様（シンプル版）

- **形式**: YAML
- **ファイル名**: `ai-context.yaml`
- **必須項目**:
  - `version`: 設定ファイルバージョン（例: "1.0"）
  - `output_mode`: `merged` | `split`
  - `base_docs_dir`: ベースディレクトリ（デフォルト: "./docs"）
  - `agents`: エージェント有効化設定
    - `cursor`: true/false
    - `cline`: true/false
    - `github`: true/false
    - `claude`: true/false

##### 2.4.2 型安全性

- Serde による厳密な型チェック
- シンプルなデフォルト値設定
- 基本的なバリデーション

### 3. 非機能要件

#### 3.1 パフォーマンス要件

- **起動時間**: 100ms 以内（Rust バイナリによる高速起動）
- **ファイル生成時間**: 100 ファイル未満のプロジェクトで 1 秒以内
- **メモリ使用量**: 10MB 以下（効率的なメモリ管理）

#### 3.2 可用性要件

- **Rust 対応バージョン**: 1.70.0 以上
- **OS 対応**: Windows、macOS、Linux
- **オフライン動作**: インターネット接続不要
- **クロスコンパイル対応**: 複数プラットフォーム向けバイナリ提供

#### 3.3 保守性要件

- **Rust 使用**: 型安全性・メモリ安全性の確保
- **テストカバレッジ**: 80%以上
- **ドキュメント**: 全 API・設定項目の文書化
- **エラーハンドリング**: anyhow・thiserror による堅牢なエラー処理

#### 3.4 セキュリティ要件

- **メモリ安全性**: Rust の所有権システムによる保証
- **ファイルアクセス制限**: プロジェクトディレクトリ内のみアクセス
- **入力値検証**: 全ユーザー入力の適切な検証
- **依存関係**: 既知の脆弱性を含む依存関係の排除

### 4. ユーザビリティ要件

#### 4.1 CLI インターフェース

- **直感的なコマンド名**: `init`, `generate`, `validate`, `list-agents`
- **ヘルプ機能**: `--help` オプションでの詳細説明
- **エラーメッセージ**: 分かりやすいエラーメッセージと解決方法の提示
- **進捗表示**: 絵文字による視覚的フィードバック

#### 4.2 設定ファイル

- **YAML 形式**: 人間が読みやすい形式
- **型安全性**: Serde による厳密な型チェック
- **デフォルト値**: 合理的なデフォルト設定

#### 4.3 出力ファイル

- **適切な改行**: プラットフォーム依存の改行コード対応
- **文字エンコーディング**: UTF-8 での出力
- **ファイル権限**: 適切なファイル権限の設定

### 5. 配布・インストール要件

#### 5.1 Cargo パッケージ要件

- **パッケージ名**: `aicm`
- **インストール方法**:
  - crates.io からインストール: `cargo install aicm`
  - Git から直接インストール: `cargo install --git <URL>`
  - ローカルインストール: `cargo install --path .`
- **CLI コマンド**: `aicm`

#### 5.2 バイナリ配布

- **プリビルドバイナリ**: GitHub Releases での配布
- **クロスコンパイル**: Windows、macOS、Linux 向けバイナリ
- **パッケージマネージャー**: Homebrew 等での配布検討

#### 5.3 バージョニング

- **セマンティックバージョニング**: MAJOR.MINOR.PATCH
- **後方互換性**: マイナーバージョンアップでの後方互換性保証

### 6. 技術アーキテクチャ要件

#### 6.1 言語・フレームワーク

- **言語**: Rust (Edition 2021)
- **CLI Framework**: clap v4 (derive API)
- **非同期処理**: Tokio
- **設定処理**: serde, serde_yaml
- **エラーハンドリング**: anyhow, thiserror

#### 6.2 モジュール設計

- **config**: 設定読み込み・検証
- **agents**: エージェント実装（トレイトベース）
- **core**: コア機能（Markdown マージ等）
- **types**: 型定義

#### 6.3 テスト戦略

- **ユニットテスト**: 各モジュールの単体テスト
- **統合テスト**: CLI コマンドの動作テスト
- **プロパティベーステスト**: 設定ファイル処理の堅牢性検証

### 7. 制約事項

#### 7.1 技術制約

- **Rust 依存**: Rust 環境が必要（ただしバイナリ配布で軽減）
- **ファイルシステム**: ローカルファイルシステムのみ対応
- **非同期処理**: Tokio ランタイムが必要

#### 7.2 機能制約

- **リアルタイム更新**: ファイル監視機能は初期版では非対応
- **GUI**: コマンドラインインターフェースのみ
- **クラウド連携**: 外部サービス連携は初期版では非対応

### 8. 将来拡張予定

#### 8.1 Phase 2 機能

- **ウォッチモード**: ファイル変更時の自動生成
- **Cline・GitHub Copilot・Claude Code エージェント実装**
- **設定継承**: プロジェクト階層での設定継承

#### 8.2 Phase 3 機能

- **プラグインシステム**: カスタムエージェント対応（WASM 等）
- **Web UI**: ブラウザベースの設定管理
- **クラウド同期**: チーム設定のクラウド同期

### 9. 受け入れ基準

#### 9.1 機能受け入れ基準

- [x] `aicm init` でディレクトリ構造が正しく作成される
- [x] 統合モードで Cursor の context ファイルが生成される
- [x] 分割モードで Cursor の複数ファイルが生成される
- [x] Cursor 固有設定（frontmatter）が正しく適用される
- [x] 設定ファイルの検証機能が正常に動作する

#### 9.2 品質受け入れ基準

- [x] 全テストケースがパスする
- [ ] テストカバレッジが 80%以上
- [x] Clippy エラーが存在しない
- [x] セキュリティ脆弱性が検出されない

#### 9.3 パフォーマンス受け入れ基準

- [x] 起動時間が 100ms 以内
- [x] 100 ファイルプロジェクトでの生成時間が 1 秒以内
- [x] メモリ使用量が 10MB 以下

#### 9.4 ユーザビリティ受け入れ基準

- [x] 初心者でも 5 分以内にセットアップ完了
- [x] エラーメッセージが問題解決に役立つ
- [x] ヘルプドキュメントが充実している

### 10. マイグレーション計画

#### 10.1 TypeScript から Rust への移行

- [x] TypeScript 実装からの完全移行完了
- [x] 同等機能の実装確認
- [x] パフォーマンス改善の確認

#### 10.2 今後の開発計画

1. **Phase 1 (現在)**: Cursor 実装完了、基盤整備
2. **Phase 2**: 残りエージェント実装、テスト強化
3. **Phase 3**: 高度な機能追加、エコシステム拡張
