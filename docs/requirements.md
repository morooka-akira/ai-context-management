# Requirements Document - AI Context Management Tool (Rust Edition)

## プロジェクト要件定義

### 1. プロジェクト概要

#### 1.1 目的
複数のAIコーディングエージェント用のcontextファイルを統一設定から自動生成するコマンドラインツールを開発し、Cargoパッケージとして配布する。

#### 1.2 背景
- 開発者が複数のAIツール（GitHub Copilot、Cline、Cursor、Claude Code）を使い分ける際の設定管理が煩雑
- 各ツール固有のファイル形式・配置場所・設定方法が異なる
- 同じコンテキスト情報を複数箇所で重複管理する必要がある
- チーム間での設定同期が困難

#### 1.3 解決したい課題
- コンテキスト設定の一元管理
- ファイル形式の差異の吸収
- 設定変更時の更新作業の自動化
- チーム全体での設定共有の促進
- パフォーマンスの向上（Rustによる高速化）

### 2. 機能要件

#### 2.1 サポート対象AIツール

| ツール名 | 出力ファイル | 形式 | 分割対応 | 実装状況 |
|---------|-------------|------|---------|----------|
| Cursor | `.cursor/rules/*.mdc` | MDC (Markdown + frontmatter) | ○ | ✅ 実装済み |
| Cline | `.clinerules/*.md` | Markdown | ○ | 🚧 今後実装 |
| GitHub Copilot | `instructions.md` (階層配置) | Markdown | ○ | 🚧 今後実装 |
| Claude Code | `CLAUDE.md` | Markdown | × | 🚧 今後実装 |

#### 2.2 コア機能

##### 2.2.1 初期化機能 (`ai-context init`)
- **必須機能**:
  - `docs/` ディレクトリ構造の自動作成
  - 設定ファイル `ai-context.yaml` のテンプレート生成
  - サンプルMarkdownファイルの生成

- **ディレクトリ構造**:
```
docs/
├── common/           # 共通ナレッジ
│   ├── coding-standards.md
│   ├── project-overview.md
│   └── team-conventions.md
├── agents/           # エージェント固有設定
│   ├── github.md
│   ├── cline.md
│   ├── cursor.md
│   └── claude.md
└── ai-context.yaml   # 設定ファイル
```

##### 2.2.2 生成機能 (`ai-context generate`)
- **統合モード（デフォルト）**:
  - 全Markdownファイルを結合
  - 各エージェントに1つのcontextファイルとして出力

- **分割モード (`output_mode: split`)**:
  - 分割対応エージェント（GitHub Copilot、Cline、Cursor）は複数ファイルで出力
  - 非対応エージェント（Claude）は統合モードと同じ

- **エージェント指定 (`--agent`)**:
  - 特定のエージェントのみファイル生成
  - 現在は `cursor` のみ対応

##### 2.2.3 検証機能 (`ai-context validate`)
- 設定ファイルの構文チェック
- 必要なMarkdownファイルの存在確認
- エージェント固有設定の妥当性検証

##### 2.2.4 エージェント一覧機能 (`ai-context list-agents`)
- 利用可能なエージェント一覧表示
- 各エージェントの実装状況表示

#### 2.3 エージェント固有機能

##### 2.3.1 Cursor固有機能 ✅ 実装済み
- **frontmatter対応**:
  - `type`: `always` | `auto_attached` | `agent_requested` | `manual`
  - `description`: ルールの説明
  - `globs`: 適用対象ファイルパターン
  - `alwaysApply`: 常に適用するかどうか

- **分割ファイル生成**:
  - 設定に基づいて複数の `.mdc` ファイルを生成
  - 各ファイルに適切なfrontmatterを付与

##### 2.3.2 Cline固有機能 🚧 今後実装
- **数値プレフィックス対応**:
  - ファイル名に数値プレフィックスを付与（例: `01-common.md`）
  - 読み込み順序の制御

- **分割ファイル生成**:
  - 設定に基づいて複数の `.md` ファイルを生成

##### 2.3.3 GitHub Copilot固有機能 🚧 今後実装
- **階層的ファイル配置**:
  - ワークスペース内の任意の場所に `instructions.md` を配置
  - ディレクトリ階層に応じた適用スコープの制御
  - より具体的な（深い）指示が優先される階層システム

- **スコープ別設定**:
  - `workspace`: プロジェクト全体に適用
  - `source_code`: ソースコードディレクトリに適用
  - `ui_components`: UIコンポーネントに適用

##### 2.3.4 Claude Code固有機能 🚧 今後実装
- **言語設定対応**:
  - 日本語での出力指示の追加
- **セクション管理**:
  - 開発コマンド、アーキテクチャ情報等の構造化

#### 2.4 設定システム

##### 2.4.1 設定ファイル仕様
- **形式**: YAML
- **ファイル名**: `ai-context.yaml`
- **必須項目**:
  - `version`: 設定ファイルバージョン
  - `output_mode`: `merged` | `split`
  - `base_docs_dir`: ベースディレクトリ（デフォルト: `./docs`）
  - `file_mapping`: ファイルマッピング設定

##### 2.4.2 型安全性
- Serdeによる厳密な型チェック
- コンパイル時の設定検証
- 実行時エラーの最小化

### 3. 非機能要件

#### 3.1 パフォーマンス要件
- **起動時間**: 100ms以内（Rustバイナリによる高速起動）
- **ファイル生成時間**: 100ファイル未満のプロジェクトで1秒以内
- **メモリ使用量**: 10MB以下（効率的なメモリ管理）

#### 3.2 可用性要件
- **Rust対応バージョン**: 1.70.0以上
- **OS対応**: Windows、macOS、Linux
- **オフライン動作**: インターネット接続不要
- **クロスコンパイル対応**: 複数プラットフォーム向けバイナリ提供

#### 3.3 保守性要件
- **Rust使用**: 型安全性・メモリ安全性の確保
- **テストカバレッジ**: 80%以上
- **ドキュメント**: 全API・設定項目の文書化
- **エラーハンドリング**: anyhow・thiserrorによる堅牢なエラー処理

#### 3.4 セキュリティ要件
- **メモリ安全性**: Rustの所有権システムによる保証
- **ファイルアクセス制限**: プロジェクトディレクトリ内のみアクセス
- **入力値検証**: 全ユーザー入力の適切な検証
- **依存関係**: 既知の脆弱性を含む依存関係の排除

### 4. ユーザビリティ要件

#### 4.1 CLIインターフェース
- **直感的なコマンド名**: `init`, `generate`, `validate`, `list-agents`
- **ヘルプ機能**: `--help` オプションでの詳細説明
- **エラーメッセージ**: 分かりやすいエラーメッセージと解決方法の提示
- **進捗表示**: 絵文字による視覚的フィードバック

#### 4.2 設定ファイル
- **YAML形式**: 人間が読みやすい形式
- **型安全性**: Serdeによる厳密な型チェック
- **デフォルト値**: 合理的なデフォルト設定

#### 4.3 出力ファイル
- **適切な改行**: プラットフォーム依存の改行コード対応
- **文字エンコーディング**: UTF-8での出力
- **ファイル権限**: 適切なファイル権限の設定

### 5. 配布・インストール要件

#### 5.1 Cargoパッケージ要件
- **パッケージ名**: `ai-context-management`
- **インストール方法**:
  - crates.ioからインストール: `cargo install ai-context-management`
  - Gitから直接インストール: `cargo install --git <URL>`
  - ローカルインストール: `cargo install --path .`
- **CLIコマンド**: `ai-context`

#### 5.2 バイナリ配布
- **プリビルドバイナリ**: GitHub Releasesでの配布
- **クロスコンパイル**: Windows、macOS、Linux向けバイナリ
- **パッケージマネージャー**: Homebrew等での配布検討

#### 5.3 バージョニング
- **セマンティックバージョニング**: MAJOR.MINOR.PATCH
- **後方互換性**: マイナーバージョンアップでの後方互換性保証

### 6. 技術アーキテクチャ要件

#### 6.1 言語・フレームワーク
- **言語**: Rust (Edition 2021)
- **CLI Framework**: clap v4 (derive API)
- **非同期処理**: Tokio
- **設定処理**: serde, serde_yaml
- **エラーハンドリング**: anyhow, thiserror

#### 6.2 モジュール設計
- **config**: 設定読み込み・検証
- **agents**: エージェント実装（トレイトベース）
- **core**: コア機能（Markdownマージ等）
- **types**: 型定義

#### 6.3 テスト戦略
- **ユニットテスト**: 各モジュールの単体テスト
- **統合テスト**: CLIコマンドの動作テスト
- **プロパティベーステスト**: 設定ファイル処理の堅牢性検証

### 7. 制約事項

#### 7.1 技術制約
- **Rust依存**: Rust環境が必要（ただしバイナリ配布で軽減）
- **ファイルシステム**: ローカルファイルシステムのみ対応
- **非同期処理**: Tokioランタイムが必要

#### 7.2 機能制約
- **リアルタイム更新**: ファイル監視機能は初期版では非対応
- **GUI**: コマンドラインインターフェースのみ
- **クラウド連携**: 外部サービス連携は初期版では非対応

### 8. 将来拡張予定

#### 8.1 Phase 2機能
- **ウォッチモード**: ファイル変更時の自動生成
- **Cline・GitHub Copilot・Claude Code エージェント実装**
- **設定継承**: プロジェクト階層での設定継承

#### 8.2 Phase 3機能
- **プラグインシステム**: カスタムエージェント対応（WASM等）
- **Web UI**: ブラウザベースの設定管理
- **クラウド同期**: チーム設定のクラウド同期

### 9. 受け入れ基準

#### 9.1 機能受け入れ基準
- [x] `ai-context init` でディレクトリ構造が正しく作成される
- [x] 統合モードでCursorのcontextファイルが生成される
- [x] 分割モードでCursorの複数ファイルが生成される
- [x] Cursor固有設定（frontmatter）が正しく適用される
- [x] 設定ファイルの検証機能が正常に動作する

#### 9.2 品質受け入れ基準
- [x] 全テストケースがパスする
- [ ] テストカバレッジが80%以上
- [x] Clippyエラーが存在しない
- [x] セキュリティ脆弱性が検出されない

#### 9.3 パフォーマンス受け入れ基準
- [x] 起動時間が100ms以内
- [x] 100ファイルプロジェクトでの生成時間が1秒以内
- [x] メモリ使用量が10MB以下

#### 9.4 ユーザビリティ受け入れ基準
- [x] 初心者でも5分以内にセットアップ完了
- [x] エラーメッセージが問題解決に役立つ
- [x] ヘルプドキュメントが充実している

### 10. マイグレーション計画

#### 10.1 TypeScriptからRustへの移行
- [x] TypeScript実装からの完全移行完了
- [x] 同等機能の実装確認
- [x] パフォーマンス改善の確認

#### 10.2 今後の開発計画
1. **Phase 1 (現在)**: Cursor実装完了、基盤整備
2. **Phase 2**: 残りエージェント実装、テスト強化
3. **Phase 3**: 高度な機能追加、エコシステム拡張